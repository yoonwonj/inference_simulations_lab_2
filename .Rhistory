set.seed(123) # good practice to set a random seed, or else different runs get you different results
# you can run install.packages('tidyverse')
library(tidyverse)
library(ggplot2) # plotting
library(ggthemes) # good for making plots pretty
make_tea_data <- function(n_total = 48,
sigma = 1.25, # sd of the distribution
delta = 1.5) {  # difference between distributions
n_half <- n_total / 2 # half of the total subjects  = #/n subs per condition
tibble(condition = c(rep("milk first", n_half), rep("tea first", n_half)),
rating = c(round(
rnorm(n_half, mean = 3.5 + delta, sd = sigma)
),
round(rnorm(
n_half, mean = 3.5, sd = sigma
)))) |>
mutate(rating = if_else(rating > 10, 10, rating), # random sampling could mean the scale gets out of range
# truncate if greater than max/min of rating scale
rating = if_else(rating < 1, 1, rating))
}
# here's, we're calling our custom function, and specifying different inputs than the defaults (which are inside the parenthese up above)
tea_data <- make_tea_data(n_total = 18, delta = .5)
tea_data_highn= make_tea_data(n_total=48)
summary(tea_data_highn)
head(tea_data_highn)
tea_data_highn= make_tea_data(n_total=48)
summary(tea_data_highn) #length=48 (N of participants)
head(tea_data_highn) #column names = "condition", "rating"
tea_data_highn %>%
group_by("condition") %>%
average_rating = mean()
tea_data_highn= make_tea_data(n_total=48)
summary(tea_data_highn) #length=48 (N of participants)
head(tea_data_highn) #column names = "condition", "rating"
tea_data_highn %>%
group_by("condition") %>%
average_rating = mean(x)
tea_data_highn= make_tea_data(n_total=48)
summary(tea_data_highn) #length=48 (N of participants)
head(tea_data_highn) #column names = "condition", "rating"
tea_data_highn %>%
group_by("condition") %>%
average_rating = mean()
tea_data_highn= make_tea_data(n_total=48)
summary(tea_data_highn) #length=48 (N of participants)
head(tea_data_highn) #column names = "condition", "rating"
tea_data_highn %>%
group_by("condition") %>%
summarize (
average_rating = mean()
)
tea_data_highn %>%
group_by("condition") %>%
summarize (
average_rating = mean(rating)
)
tea_data_highn$condition = as.factor(tea_data_highn$condition)
tea_data_highn %>%
group_by("condition") %>%
summarize (
average_rating = mean(rating)
)
tea_data_highn= make_tea_data(n_total=48)
summary(tea_data_highn) #length=48 (N of participants)
head(tea_data_highn) #column names = "condition", "rating"
tea_data_highn$condition = as.factor(tea_data_highn$condition)
tea_data_highn %>%
group_by("condition") %>%
summarize (
average_rating = mean(rating)
)
tea_data_highn$condition = as.factor(tea_data_highn$condition)
tea_data_highn %>%
group_by(condition) %>%
summarize (
average_rating = mean(rating)
)
out_low_n <- tea_data %>%
t.test(rating ~ condition, data = .,  var.equal = TRUE)
out_high_n <- tea_data_highn %>%
t.test(rating ~ condition, data = ., var.equal = TRUE)
print(out_low_n)
print(out_high_n)
samps <- tibble(sim = 1:1000) |>
mutate(data = map(sim, \(i) make_tea_data(n_total = 18, delta = 1.5))) |>  # simulate
unnest(cols = data) # wrangle
samps_highn <- tibble(sim = 1:1000) |>
mutate(data = map(sim, \(i) make_tea_data(n_total = 48, delta = 1.5))) |>  # simulate
unnest(cols = data) # wrangle
samps <- tibble(sim = 1:1000) |>
mutate(data = map(sim, \(i) make_tea_data(n_total = 18, delta = 1.5))) |>  # simulate
unnest(cols = data) # wrangle
samps_highn <- tibble(sim = 1:1000) |>
mutate(data = map(sim, \(i) make_tea_data(n_total = 48, delta = 1.5))) |>  # simulate
unnest(cols = data) # wrangle
tea_data_summary <- samps |>
group_by(sim, condition) |>
summarise(mean_rating = mean(rating)) |>
group_by(sim) |>
summarise(delta = mean_rating[condition == "milk first"] -
mean_rating[condition == "tea first"])
tea_data_summary <- samps |>
group_by(sim, condition) |>
summarise(mean_rating = mean(rating)) |>
group_by(sim) |>
summarise(delta = mean_rating[condition == "milk first"] -
mean_rating[condition == "tea first"])
print(tea_data_summary)
tea_data_summary <- samps |>
group_by(sim, condition) |>
summarise(mean_rating = mean(rating)) |>
group_by(sim) |>
summarise(delta = mean_rating[condition == "milk first"] -
mean_rating[condition == "tea first"])
tea_data_summary
tea_data_summary <- samps |>
group_by(sim, condition) |>
summarise(mean_rating = mean(rating)) |>
group_by(sim) |>
summarise(delta = mean_rating[condition == "milk first"] -
mean_rating[condition == "tea first"])
head(tea_data_summary)
tea_data_highn_summary <- samps_highn |>
group_by(sim, condition) |>
summarise(mean_rating = mean(rating)) |>
group_by(sim) |>
summarise(delta = mean_rating[condition == "milk first"] -
mean_rating[condition == "tea first"])
head(tea_data_highn_summary)
out_low_n <- tea_data %>%
t.test(rating ~ condition, data = .,  var.equal = TRUE)
#out_low_n= t.test(rating ~ condition, data = tea_data,  var.equal = TRUE)
out_high_n <- tea_data_highn %>%
t.test(rating ~ condition, data = ., var.equal = TRUE)
print(out_low_n)
print(out_high_n)
tea_data_summary <- samps |>
group_by(sim, condition) |> #group by simulation and the condition
summarise(mean_rating = mean(rating)) |> #for each group_by variable, calculate the mean rating
group_by(sim) |> #group by simulation
summarise(delta = mean_rating[condition == "milk first"] -
mean_rating[condition == "tea first"]) #for each group_by variable, calculate the differences in mean ratings (subtract the mean rating in "tea first" condition from the mean rating in "milk first" condition)
head(tea_data_summary)
install.packages("apa")
library(apa)
apa_highn= t_apa(out_high_n)
install.packages("apa")
library(apa)
apa_highn= t_apa(out_high_n)
install.packages("apa")
#install.packages("apa")
library(apa)
apa_highn= t_apa(out_high_n)
#install.packages("apa")
library(apa)
apa= t_apa(out_low_n)
apa_highn= t_apa(out_high_n)
#install.packages("apa")
library(apa)
apa= t_apa(out_low_n)
print('/n')
apa_highn= t_apa(out_high_n)
#install.packages("apa")
library(apa)
apa= t_apa(out_low_n)
print('\n')
apa_highn= t_apa(out_high_n)
#install.packages("apa")
library(apa)
apa= t_apa(out_low_n)
print('\newline')
apa_highn= t_apa(out_high_n)
#install.packages("apa")
library(apa)
apa= t_apa(out_low_n)
print('\n')
apa_highn= t_apa(out_high_n)
apa_highn= t_apa(out_high_n)
#install.packages("apa")
library(apa)
apa= t_apa(out_low_n)
hist(tea_data_summary$delta)
hist(tea_data_highn_summary$delta)
# Simulate the null distribution
make_tea_data_zero <- function(n_total = 48,
sigma = 1.25, # sd of the distribution
delta = 0) {  # difference between distributions
n_half <- n_total / 2 # half of the total subjects  = #/n subs per condition
tibble(condition = c(rep("milk first", n_half), rep("tea first", n_half)),
rating = c(round(
rnorm(n_half, mean = 3.5 + delta, sd = sigma)
),
round(rnorm(
n_half, mean = 3.5, sd = sigma
)))) |>
mutate(rating = if_else(rating > 10, 10, rating), # random sampling could mean the scale gets out of range
# truncate if greater than max/min of rating scale
rating = if_else(rating < 1, 1, rating))
}
hist(make_tea_data_zero)
hist(make_tea_data_zero$rating)
make_tae_data_zero
make_tea_data_zero
tea_data_zero <- make_tea_data(n_total = 1000, delta = 0)
samps_zero <- tibble(sim = 1:1000) |>
mutate(data = map(sim, \(i) make_tea_data(n_total = 18, delta = 0))) |>  # simulate
unnest(cols = data) # wrangle
tea_data_zero_summary <- samps_zero |>
group_by(sim, condition) |>
summarise(mean_rating = mean(rating)) |>
group_by(sim) |>
summarise(delta = mean_rating[condition == "milk first"] -
mean_rating[condition == "tea first"])
head(tea_data_zero_summary)
hist(make_tea_data_zero$delta)
hist(tea_data_zero_summary$delta)
tea_data_highn_shuffled <- samps_highn %>%
group_by(sim) %>% # for each experiment
mutate(condition_shuffled = sample(condition)) # shuffle the condition labels, handy function here.
tea_data_highn_shuffled <- samps_highn %>%
group_by(sim) %>% # for each experiment
mutate(condition_shuffled = sample(condition)) # shuffle the condition labels, handy function here.
tea_data_highn_shuffled_summary <- tea_data_highn_shuffled %>%
group_by(condition_shuffled, sim) %>%
summarize(mean_rating = mean(rating),
sd = sd(rating))
# overwrites this variable
tea_data_highn_shuffled_summary <- tea_data_highn_shuffled_summary %>%
group_by(sim) |>
summarise(delta = mean_rating[condition_shuffled == "milk first"] -
mean_rating[condition_shuffled == "tea first"])
hist(tea_data_highn_shuffled_summary$delta) #what does this histogram look like?
ggplot(data = tea_data_highn_shuffled %>% filter(sim==3),  # can change the actual simulation number here
mapping = aes(x = condition_shuffled, y = rating))+
geom_point(mapping = aes(color = condition), # color
alpha=.8,
position = position_jitter(height = .1,
width = 0.1)) +
stat_summary(fun.data = mean_cl_boot, # this boostraps the confidence interval
geom = "linerange",
size = 1) +
stat_summary(fun = "mean", # this calculates the average
geom = "point",
shape = 21,
color = "black",
fill = "white") +
scale_y_continuous(breaks = 0:10,
labels = 0:10,
limits = c(0, 10))
difference_actual = tea_data_highn %>%  # in ONE experiment
group_by(condition) %>%
summarize(mean = mean(rating)) %>%
pull(mean) %>%
diff()
ggplot(data = tea_data_highn_shuffled_summary, aes(x=delta)) +
geom_histogram(aes(y = stat(density)),
color = "black",
fill = "lightblue",
binwidth = 0.05) +
stat_density(geom = "line",
size = 1.5,
bw = 0.2) +
geom_vline(xintercept = difference_actual, color = "red", size = 2) +
labs(x = "difference between means")
tea_data_highn_shuffled_summary %>%
summarize(p_value = sum(delta <= difference_actual)/n())
ggplot(data=tea_data_highn_shuffled_summary, aes(x=delta)) +
geom_histogram(alpha=.4, bins=20, color='blue', fill='blue') +
geom_histogram(alpha=.8, bins=20, data=tea_data_highn_summary)
tea_dataset = tea_data_highn
tea_dataset = tea_data_highn
tea_ratings <- filter(tea_dataset, condition == "tea first")$rating
milk_ratings <- filter(tea_dataset, condition == "milk first")$rating
# could also do in a pipe like so, but then you have to grab the column below, as in tea_ratings$ratings; above is a vector
# tea_ratings <- tea_data_highn %>%
#   filter(condition=="tea first") %>%
#   select(rating)
n_tea <- length(tea_ratings)
n_milk <- length(milk_ratings)
sd_tea <- sd(tea_ratings)
sd_milk <- sd(milk_ratings)
tea_sd_pooled <- sqrt(((n_tea - 1) * sd_tea ^ 2 + (n_milk - 1) * sd_milk ^ 2) /
(n_tea + n_milk - 2))
tea_se <- tea_sd_pooled * sqrt((1 / n_tea) + (1 / n_milk))
delta_hat <- mean(milk_ratings) - mean(tea_ratings)
tea_ci_lower <- delta_hat - tea_se * qnorm(0.975)
tea_ci_upper <- delta_hat + tea_se * qnorm(0.975)
num_observations = length(tea_dataset$rating)
df = num_observations-2 # for two sample t.test
tea_ci_lower_ttest <- delta_hat - tea_se * qt(0.975,df)
tea_ci_upper_ttest <- delta_hat + tea_se * qt(0.975,df)
# Now the calculated CIs match those in the t-test outputs!
t.test(tea_ratings, milk_ratings, var.equal=TRUE)
num_observations = length(tea_dataset$rating)
df = num_observations-2 # for two sample t.test
tea_ci_lower_ttest <- delta_hat - tea_se * qt(0.975,df)
tea_ci_upper_ttest <- delta_hat + tea_se * qt(0.975,df)
tea_ci_lower_test
num_observations = length(tea_dataset$rating)
df = num_observations-2 # for two sample t.test
tea_ci_lower_ttest <- delta_hat - tea_se * qt(0.975,df)
tea_ci_upper_ttest <- delta_hat + tea_se * qt(0.975,df)
tea_ci_lower_ttest
tea_ci_upper_ttest
confidence_level=.95 # you can change this
# this formula below gives the critical t-value (as opposed to simply taken from the normal distribution)
# qt(1 - (1 - confidence_level)/2, df = n - 1)
tea_data_highn_summary_cis <- tea_data_highn %>%
group_by(condition) %>%
summarize(cond_mean = mean(rating), cond_sd = sd(rating), n=length(rating)) %>%
mutate(error = qt(1 - (1 - confidence_level)/2, df = n - 1)* (cond_sd/sqrt(n))) %>% # this calculates CIs WITHIN each condition
mutate(ci_upper = cond_mean + error, ci_lower = cond_mean - error) %>%
mutate(se_upper = cond_mean + cond_sd/sqrt(n), se_lower = cond_mean - cond_sd/sqrt(n))
ggplot(data = tea_data_highn, aes(x=condition, y=rating, col=condition))  +
geom_jitter(width=.1, height=0, alpha=.3) + # visualizes all the raw data, with no variation in y-axis jitter
theme_few() +
geom_pointrange(data = tea_data_highn_summary_cis, aes(x=condition, y = cond_mean, ymin = ci_lower, ymax = ci_upper)) +
ylim(0,10) +
ggtitle('Tea ratings across conditions with CIs')
ggplot(data = tea_data_highn, aes(x=condition, y=rating, col=condition))  +
geom_jitter(width=.1, height=0, alpha=.5) + # visualizes all the raw data, with no variation in y-axis jitter
theme_few() +
geom_pointrange(data = tea_data_highn_summary_cis, aes(x=condition, y = cond_mean, ymin = se_lower, ymax = se_upper)) +
ylim(0,10) +
ggtitle('Tea ratings across condition with SE')
tea_dataset_low = tea_data_lown
tea_dataset_low = tea_data
tea_ratings_low <- filter(tea_dataset_low, condition == "tea first")$rating
milk_ratings_low <- filter(tea_dataset_low, condition == "milk first")$rating
n_tea <- length(tea_ratings_low)
n_milk <- length(milk_ratings_low)
sd_tea <- sd(tea_ratings_low)
sd_milk <- sd(milk_ratings_low)
tea_sd_pooled <- sqrt(((n_tea - 1) * sd_tea ^ 2 + (n_milk - 1) * sd_milk ^ 2) /
(n_tea + n_milk - 2))
tea_se <- tea_sd_pooled * sqrt((1 / n_tea) + (1 / n_milk))
delta_hat <- mean(milk_ratings) - mean(tea_ratings)
tea_ci_lower <- delta_hat - tea_se * qnorm(0.975)
tea_ci_upper <- delta_hat + tea_se * qnorm(0.975)
num_observations = length(tea_dataset$rating)
df = num_observations-2 # for two sample t.test
tea_ci_lower_ttest <- delta_hat - tea_se * qt(0.975,df)
tea_ci_upper_ttest <- delta_hat + tea_se * qt(0.975,df)
tea_ci_lower_ttest
tea_ci_upper_ttest
confidence_level=.95 # you can change this
# this formula below gives the critical t-value (as opposed to simply taken from the normal distribution)
# qt(1 - (1 - confidence_level)/2, df = n - 1)
tea_data_lown_summary_cis <- tea_data_lown %>%
group_by(condition) %>%
summarize(cond_mean = mean(rating), cond_sd = sd(rating), n=length(rating)) %>%
mutate(error = qt(1 - (1 - confidence_level)/2, df = n - 1)* (cond_sd/sqrt(n))) %>% # this calculates CIs WITHIN each condition
mutate(ci_upper = cond_mean + error, ci_lower = cond_mean - error) %>%
mutate(se_upper = cond_mean + cond_sd/sqrt(n), se_lower = cond_mean - cond_sd/sqrt(n))
confidence_level=.95 # you can change this
# this formula below gives the critical t-value (as opposed to simply taken from the normal distribution)
# qt(1 - (1 - confidence_level)/2, df = n - 1)
tea_data_lown_summary_cis <- tea_data %>%
group_by(condition) %>%
summarize(cond_mean = mean(rating), cond_sd = sd(rating), n=length(rating)) %>%
mutate(error = qt(1 - (1 - confidence_level)/2, df = n - 1)* (cond_sd/sqrt(n))) %>% # this calculates CIs WITHIN each condition
mutate(ci_upper = cond_mean + error, ci_lower = cond_mean - error) %>%
mutate(se_upper = cond_mean + cond_sd/sqrt(n), se_lower = cond_mean - cond_sd/sqrt(n))
ggplot(data = tea_data, aes(x=condition, y=rating, col=condition))  +
geom_jitter(width=.1, height=0, alpha=.3) + # visualizes all the raw data, with no variation in y-axis jitter
theme_few() +
geom_pointrange(data = tea_data_lown_summary_cis, aes(x=condition, y = cond_mean, ymin = ci_lower, ymax = ci_upper)) +
ylim(0,10) +
ggtitle('Tea ratings across conditions with CIs')
ggplot(data = tea_data, aes(x=condition, y=rating, col=condition))  +
geom_jitter(width=.1, height=0, alpha=.5) + # visualizes all the raw data, with no variation in y-axis jitter
theme_few() +
geom_pointrange(data = tea_data_lown_summary_cis, aes(x=condition, y = cond_mean, ymin = se_lower, ymax = se_upper)) +
ylim(0,10) +
ggtitle('Tea ratings across condition with SE')
